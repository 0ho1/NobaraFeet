local a = game:GetService("Players")
local b = game:GetService("ReplicatedStorage")
local c = game:GetService("RunService")
local d = game:GetService("Workspace")
local e = a.LocalPlayer
local g = b.Remotes:WaitForChild("ServerCombatHandler")

repeat task.wait() until game:IsLoaded()
repeat task.wait() until e.Character

assert(isnetworkowner, "does not support isnetworkowner.")
task.wait()

local originalCFrame = e.Character:WaitForChild("HumanoidRootPart").CFrame
local bossKilled = false

local function s()
	coroutine.resume(coroutine.create(function()
		for y, z in next, d.Entities:GetChildren() do
			if not game.Players:GetPlayerFromCharacter(z) then
				if z.Name ~= e.Name and z:FindFirstChild("Head") then
					e.Character.HumanoidRootPart.CFrame = z.HumanoidRootPart.CFrame * CFrame.new(0, 0 + math.random(1, 2), 0) * CFrame.Angles(math.rad(-75), 0, 0)
					e.Character.HumanoidRootPart.Velocity = Vector3.new()
					if e.Character:FindFirstChild("Zanpakuto") then
						e.Character.CharacterHandler.Remotes.Weapon:FireServer()
					end
					g:FireServer("LightAttack")
					if isnetworkowner(z.HumanoidRootPart) or isnetworkowner(z.Head) then
						z.Head:Destroy()
						task.wait()
						z.Humanoid.Health = 0
						z.HumanoidRootPart.CFrame = CFrame.new(Vector3.new(0, -100000, 0)) * CFrame.Angles(math.rad(-90), 0, 0)
						z.HumanoidRootPart.Velocity = Vector3.new(0, -1e7, 0)
						bossKilled = true
					end
				end
			end
		end
	end))
end

local Connection

task.spawn(
        function()
            Connection = c.Heartbeat:Connect(
                function()
                    if not bossKilled and getgenv().Active then
			s()
		    else
			task.wait()
    			e.Character.HumanoidRootPart.CFrame = originalCFrame
			Connection:Disconnect()
		    end
                end
            )
        end
)
