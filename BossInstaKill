local a = game:GetService("Players")
local b = game:GetService("ReplicatedStorage")
local c = game:GetService("RunService")
local d = game:GetService("Workspace")
local e = a.LocalPlayer
local g = b.Remotes:WaitForChild("ServerCombatHandler")

repeat task.wait() until game:IsLoaded()
repeat task.wait() until e.Character

assert(isnetworkowner, "does not support isnetworkowner.")
task.wait()

local bossKilled = false

local function s()
	coroutine.resume(coroutine.create(function()
		for y, z in next, d.Entities:GetChildren() do
			if not game.Players:GetPlayerFromCharacter(z) then
				if z.Name ~= e.Name and z:FindFirstChild("Head") then
					if not z:FindFirstChild("timeSpawned") then
						local timeSpawned = Instance.new("NumberValue", z)
						timeSpawned.Name = "timeSpawned"
						timeSpawned.Value = tick()
					end
					if z:FindFirstChild("Humanoid") and z:FindFirstChildOfClass("Shirt") and z:FindFirstChildOfClass("Pants") and z:FindFirstChildOfClass("BodyColors") then
						if tick() - z.timeSpawned.Value > 0.1 then
							e.Character.HumanoidRootPart.CFrame = z.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0) * CFrame.Angles(math.rad(-100), 0, 0)
							e.Character.HumanoidRootPart.Velocity = Vector3.new()
							if e.Character:FindFirstChild("Zanpakuto") then
								e.Character.CharacterHandler.Remotes.Weapon:FireServer()
							end
							g:FireServer("LightAttack")
							if isnetworkowner(z.HumanoidRootPart) or isnetworkowner(z.Head) then
								z.Head:Destroy()
								task.wait()
								if isnetworkowner(z.HumanoidRootPart) then
									z.Humanoid.Health = 0
									z.HumanoidRootPart.CFrame = CFrame.new(Vector3.new(0, -100000, 0)) * CFrame.Angles(math.rad(-90), 0, 0)
									z.HumanoidRootPart.Velocity = Vector3.new(0, -1e7, 0)
									bossKilled = true
								elseif z.Humanoid.Health == 0 then
									bossKilled = true
								end
							end
						end
					end
				end
			end
		end
	end))
end

local Connection

task.spawn(
        function()
            Connection = c.Heartbeat:Connect(
                function()
                    if not bossKilled and getgenv().Active then
			s()
		    else
			task.wait()
    			e.Character.HumanoidRootPart.CFrame = CFrame.new(-29.2525959, 4423.4043, -15.5252666, 0.144498095, -4.58166376e-08, -0.989505053, -1.12855849e-08, 1, -4.79506213e-08, 0.989505053, 1.80959177e-08, 0.144498095)
			if z.Humanoid.Health == 0 then
				Connection:Disconnect()
			else
				bossKilled = false
			end
		    end
                end
            )
        end
)
